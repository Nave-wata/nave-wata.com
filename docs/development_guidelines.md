# 開発ガイドライン

このドキュメントでは、Nave-Wataプロジェクトの開発ガイドラインとコーディング規約について説明します。

## 基本原則

1. **クリーンアーキテクチャの遵守**
   - 各層の責任を明確に分離し、依存関係の方向を内側に向けること
   - 外側の層は内側の層に依存できるが、内側の層は外側の層に依存してはならない

2. **シンプルな実装**
   - 必要以上に複雑な実装は避ける
   - 現時点では単純にビューを表示するだけの実装で十分な場合は、複雑なデータ取得ロジックは実装しない

3. **ドキュメント駆動開発**
   - コードを書く前に、その目的と設計を文書化する
   - PHPDocコメントを適切に記述する

## コーディング規約

### PHP

1. **PSR-1, PSR-2, PSR-12 の遵守**
   - [PSR-1: 基本コーディング規約](https://www.php-fig.org/psr/psr-1/)
   - [PSR-2: コーディングスタイルガイド](https://www.php-fig.org/psr/psr-2/)
   - [PSR-12: 拡張コーディングスタイルガイド](https://www.php-fig.org/psr/psr-12/)

2. **命名規則**
   - クラス名: PascalCase (例: `HomeController`)
   - メソッド名: camelCase (例: `getHomeData`)
   - 変数名: camelCase (例: `$userData`)
   - 定数: UPPER_CASE (例: `MAX_RETRY_COUNT`)

3. **PHPDocコメント**
   - すべてのクラス、メソッド、プロパティにPHPDocコメントを記述する
   - パラメータと戻り値の型を明示する
   - メソッドの目的と動作を簡潔に説明する

### Twig

1. **テンプレート構造**
   - 共通レイアウトを `layouts/` ディレクトリに配置する
   - ページ固有のテンプレートは `templates/` ディレクトリの直下に配置する

2. **命名規則**
   - テンプレートファイル名: snake_case (例: `user_profile.twig`)
   - ブロック名: snake_case (例: `{% block page_content %}`)
   - 変数名: snake_case (例: `{{ user_name }}`)

3. **ベストプラクティス**
   - ロジックはコントローラーに実装し、テンプレートにはできるだけロジックを含めない
   - 共通の要素は部分テンプレートとして抽出する
   - テンプレートの継承を活用する

## アーキテクチャガイドライン

### Domain層

- エンティティとビジネスロジックを含む
- 外部のフレームワークやライブラリに依存しない
- リポジトリのインターフェースを定義する

### Application層

- ユースケースを実装する
- Domain層のエンティティとリポジトリインターフェースを使用する
- 外部のフレームワークやライブラリに依存しない

### Interfaces層

- コントローラーとプレゼンターを含む
- HTTPリクエストの処理とレスポンスの生成を担当する
- Application層のユースケースを使用する

### Infrastructure層

- 外部サービスとの連携を担当する
- Domain層で定義されたリポジトリインターフェースを実装する
- データベース、ファイルシステム、外部APIなどへのアクセスを担当する

## テスト

1. **単体テスト**
   - 各クラスの機能を個別にテストする
   - モックを使用して依存関係を分離する

2. **統合テスト**
   - 複数のコンポーネントの連携をテストする
   - 実際のデータベースやファイルシステムを使用する

3. **エンドツーエンドテスト**
   - ユーザーの視点からアプリケーション全体の動作をテストする
   - ブラウザの自動化ツールを使用する

## セキュリティガイドライン

1. **入力検証**
   - すべてのユーザー入力を検証する
   - SQLインジェクションやXSSなどの攻撃を防止する

2. **認証と認可**
   - 適切な認証メカニズムを実装する
   - 権限に基づいたアクセス制御を実装する

3. **機密情報の保護**
   - パスワードは適切にハッシュ化する
   - APIキーなどの機密情報は環境変数で管理する