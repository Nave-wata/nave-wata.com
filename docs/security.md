# セキュリティ (Security)

このドキュメントでは、Nave-Wataプロジェクトで実装されているセキュリティ対策について説明します。

## ウェブサーバーのセキュリティ

### ディレクトリアクセス制限

- `.htaccess` ファイルへのアクセスは拒否されます
- `index.php` 以外の PHP ファイルへの直接アクセスは拒否されます
- ディレクトリインデックスは無効化されています

これらの制限により、重要なファイルやディレクトリの内容が外部から閲覧されることを防止しています。

### フロントコントローラーパターン

すべてのリクエストは `public/index.php` を通じて処理されます。これにより：

- アプリケーションのソースコードが公開ディレクトリの外部に配置され、直接アクセスできなくなります
- すべてのリクエストに対して一貫したセキュリティチェックを適用できます
- ルーティングとリクエスト処理を一元管理できます

## アプリケーションのセキュリティ

### 入力検証

すべてのユーザー入力は適切に検証され、サニタイズされるべきです：

- フォーム入力は適切なバリデーションルールで検証します
- URLパラメータは型チェックと範囲チェックを行います
- JSONリクエストは適切なスキーマで検証します

### XSS対策

クロスサイトスクリプティング（XSS）攻撃を防止するために：

- Twigテンプレートエンジンの自動エスケープ機能を使用しています
- HTMLコンテキストでは `htmlspecialchars()` を使用します
- JavaScriptコンテキストでは `json_encode()` を使用します
- 信頼できない入力を `raw` フィルターでエスケープ解除しないようにします

### CSRF対策

クロスサイトリクエストフォージェリ（CSRF）攻撃を防止するために：

- フォーム送信にはCSRFトークンを含めます
- トークンの検証を行います
- セッションごとに一意のトークンを生成します

### SQLインジェクション対策

SQLインジェクション攻撃を防止するために：

- プリペアドステートメントを使用します
- パラメータバインディングを使用します
- 生のSQLクエリを直接実行しないようにします

### セッション管理

セキュアなセッション管理のために：

- セッションIDは適切に保護されます
- セッションタイムアウトが設定されています
- セッションハイジャック対策が実装されています

## 環境変数とシークレット

機密情報は環境変数で管理し、ソースコードに直接記述しないようにします：

- データベース認証情報
- APIキー
- その他のシークレット

これらの情報は `.env` ファイルに保存され、バージョン管理されません。代わりに `.env.example` ファイルがテンプレートとして提供されています。

## セキュリティのベストプラクティス

### 定期的な更新

- 依存パッケージを定期的に更新し、セキュリティパッチを適用します
- セキュリティ脆弱性のアラートを監視します

### 最小権限の原則

- アプリケーションは必要最小限の権限で実行されるべきです
- データベースユーザーは必要な操作のみを許可されるべきです

### エラー処理

- 本番環境では詳細なエラーメッセージを表示しないようにします
- エラーはログに記録し、ユーザーには一般的なメッセージを表示します

### セキュリティテスト

- 定期的にセキュリティテストを実施します
- 脆弱性スキャンを行います
- コードレビューでセキュリティの問題を確認します