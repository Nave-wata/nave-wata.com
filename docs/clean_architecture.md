# クリーンアーキテクチャ実装サンプル

このプロジェクトは、PHPでのクリーンアーキテクチャの実装例を示しています。各レイヤーの役割と実装方法を説明します。

## クリーンアーキテクチャとは

クリーンアーキテクチャは、ソフトウェアをレイヤー（層）に分割し、依存関係を内側に向けることで、テスト容易性、保守性、拡張性を高めるアーキテクチャパターンです。

主な特徴：
- **依存関係ルール**: 外側のレイヤーは内側のレイヤーに依存できますが、内側のレイヤーは外側のレイヤーに依存してはいけません
- **関心の分離**: 各レイヤーは特定の責務を持ち、他のレイヤーの詳細を知る必要がありません
- **テスト容易性**: ビジネスロジックがフレームワークやデータベースから独立しているため、テストが容易になります

## プロジェクト構造

このプロジェクトは以下の4つの主要レイヤーで構成されています：

### 1. ドメイン層 (Domain Layer)

ビジネスロジックの中心部分を含み、他のレイヤーに依存しません。

- **エンティティ (Entities)**: ビジネスオブジェクトとルールを表現
  - 例: `User.php`

- **値オブジェクト (Value Objects)**: 値とその振る舞いをカプセル化
  - 例: `Email.php`

- **リポジトリインターフェース (Repository Interfaces)**: データアクセスの抽象化
  - 例: `UserRepositoryInterface.php`

- **ドメインサービス (Domain Services)**: エンティティに属さないドメインロジック
  - 例: `UserDomainService.php`

### 2. アプリケーション層 (Application Layer)

ユースケースを実装し、ドメイン層のオブジェクトを調整します。

- **ユースケース (Use Cases)**: アプリケーションの特定の機能を実装
  - 例: `UserUseCase.php`, `HomeUseCase.php`

- **DTOs (Data Transfer Objects)**: レイヤー間のデータ転送用オブジェクト
  - 例: `UserDTO.php`

- **アプリケーションサービス (Application Services)**: 複数のユースケースで共有される機能
  - 例: `UserService.php`

### 3. インフラストラクチャ層 (Infrastructure Layer)

技術的な実装の詳細を提供します。

- **リポジトリ実装 (Repository Implementations)**: データアクセスの具体的な実装
  - 例: `InMemoryUserRepository.php`

### 4. インターフェース層 (Interface Layer)

外部とのやり取りを担当します。

- **コントローラー (Controllers)**: HTTPリクエストの処理
  - 例: `UserController.php`, `HomeController.php`

- **プレゼンター (Presenters)**: 表示用データの整形
  - 例: `UserPresenter.php`

## 依存関係の流れ

依存関係は常に外側から内側に向かいます：

```
インターフェース層 → アプリケーション層 → ドメイン層 ← インフラストラクチャ層
```

## 実装例の説明

### ドメイン層の例

#### エンティティ (User.php)

ユーザーエンティティはビジネスルールを含み、状態を持ちます。例えば、ユーザー名は3文字以上である必要があるというルールを実装しています。

#### 値オブジェクト (Email.php)

メールアドレスを表す値オブジェクトで、不変性と自己検証の特性を持ちます。メールアドレスの形式検証や特定ドメインの禁止などのビジネスルールを含みます。

#### リポジトリインターフェース (UserRepositoryInterface.php)

データアクセスの抽象化を提供し、ドメイン層がデータストレージの詳細に依存しないようにします。

#### ドメインサービス (UserDomainService.php)

エンティティに属さないドメインロジックを提供します。例えば、ユーザー名の強度評価や、2つのユーザーのメールドメインが同じかどうかの判定などです。

### アプリケーション層の例

#### ユースケース (UserUseCase.php)

ユーザー関連の機能（全ユーザーの取得、ユーザー名の変更など）を実装します。ドメインオブジェクトを調整し、アプリケーションのフローを制御します。

#### DTO (UserDTO.php)

ドメインエンティティとプレゼンテーション層の間でデータを転送するためのオブジェクトです。エンティティの内部構造を隠蔽します。

#### アプリケーションサービス (UserService.php)

複数のユースケースで共有される機能を提供します。例えば、メールアドレスによるユーザー検索やユーザーデータの検証などです。

### インフラストラクチャ層の例

#### リポジトリ実装 (InMemoryUserRepository.php)

`UserRepositoryInterface`の実装で、メモリ内にユーザーデータを保存します。実際のアプリケーションではデータベースを使用する実装に置き換えられます。

### インターフェース層の例

#### コントローラー (UserController.php)

HTTPリクエストを受け取り、ユースケースを呼び出し、レスポンスを返します。ルーティングとリクエスト/レスポンスの処理を担当します。

#### プレゼンター (UserPresenter.php)

ユースケースからのデータを表示用に整形します。HTML表示用とAPI用の異なる形式を提供します。

## クリーンアーキテクチャの利点

1. **保守性**: 各レイヤーが明確に分離されているため、変更の影響範囲が限定されます
2. **テスト容易性**: ビジネスロジックがフレームワークやデータベースから独立しているため、単体テストが容易です
3. **拡張性**: 新しい機能や技術を追加する際に、既存のコードへの影響を最小限に抑えられます
4. **フレームワーク独立性**: ビジネスロジックがフレームワークに依存しないため、フレームワークの変更が容易です

## まとめ

このプロジェクトは、PHPでのクリーンアーキテクチャの実装方法を示しています。各レイヤーの責務を明確に分離し、依存関係を内側に向けることで、保守性、テスト容易性、拡張性の高いコードベースを実現しています。